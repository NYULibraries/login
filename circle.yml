machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
    - pip install docker-compose
  services:
    - docker

dependencies:
  override:
    - docker-compose version
    - docker-compose up -d

database:
  override:
    - docker-compose run web rake db:create db:schema:load --trace

test:
  override:
    - docker-compose run web rspec --color --format progress
    - docker-compose run web cucumber --format pretty
    - docker-compose run -e CI=$CI -e CODECLIMATE_REPO_TOKEN=$CODECLIMATE_REPO_TOKEN -e COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN web rake coveralls:push
